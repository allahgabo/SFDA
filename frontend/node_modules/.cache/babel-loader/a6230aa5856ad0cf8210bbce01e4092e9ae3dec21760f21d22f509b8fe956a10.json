{"ast":null,"code":"import axios from 'axios';\nconst BASE = '/api';\nconst api = axios.create({\n  baseURL: BASE\n});\n\n// ── REQUEST: inject token on every call ───────────────────────────────────\napi.interceptors.request.use(cfg => {\n  const token = localStorage.getItem('sfda_token');\n  if (token) cfg.headers.Authorization = `Token ${token}`;\n  return cfg;\n});\n\n// ── RESPONSE: on 401 → wipe stale token and force re-login ───────────────\napi.interceptors.response.use(res => res, err => {\n  var _err$response;\n  if (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status) === 401) {\n    var _err$config;\n    // Only clear if it's NOT an auth endpoint (avoid loop on wrong password)\n    const url = ((_err$config = err.config) === null || _err$config === void 0 ? void 0 : _err$config.url) || '';\n    const isAuthEndpoint = url.includes('/auth/login') || url.includes('/auth/signup');\n    if (!isAuthEndpoint) {\n      localStorage.removeItem('sfda_token');\n      localStorage.removeItem('sfda_user');\n      // Reload → App.jsx will detect no token and show login\n      window.location.reload();\n    }\n  }\n  return Promise.reject(err);\n});\n\n// ── Auth API ──────────────────────────────────────────────────────────────\nexport const authLogin = (email, password) => api.post('/auth/login/', {\n  email,\n  password\n});\nexport const authSignup = data => api.post('/auth/signup/', data);\nexport const authForgot = email => api.post('/auth/forgot/', {\n  email\n});\nexport const authLogout = () => api.post('/auth/logout/');\nexport const authMe = () => api.get('/auth/me/');\n\n// ── Auth helpers (localStorage) ───────────────────────────────────────────\nexport const saveAuth = (token, user) => {\n  localStorage.setItem('sfda_token', token);\n  localStorage.setItem('sfda_user', JSON.stringify(user));\n};\nexport const clearAuth = () => {\n  localStorage.removeItem('sfda_token');\n  localStorage.removeItem('sfda_user');\n};\nexport const getStoredUser = () => {\n  try {\n    return JSON.parse(localStorage.getItem('sfda_user'));\n  } catch {\n    return null;\n  }\n};\nexport const isAuthenticated = () => !!localStorage.getItem('sfda_token');\n\n// ── Reports API ───────────────────────────────────────────────────────────\nexport const getReports = () => api.get('/reports/');\nexport const getReport = id => api.get(`/reports/${id}/`);\nexport const createReport = data => api.post('/reports/', data);\nexport const updateReport = (id, data) => api.patch(`/reports/${id}/`, data);\nexport const deleteReport = id => api.delete(`/reports/${id}/`);\nexport const generateAI = id => api.post(`/reports/${id}/generate/`);\nexport const getStats = () => api.get('/stats/');\nexport const chatAssistant = (messages, system) => api.post('/assistant/', {\n  messages,\n  system\n});\n\n// ── PDF / Preview URLs ────────────────────────────────────────────────────\nexport const getPDFUrl = id => `${BASE}/reports/${id}/pdf/`;\nexport const getInlinePDFUrl = id => `${BASE}/reports/${id}/pdf/inline/`;\nexport const getPreviewUrl = id => `${BASE}/reports/${id}/preview/`;","map":{"version":3,"names":["axios","BASE","api","create","baseURL","interceptors","request","use","cfg","token","localStorage","getItem","headers","Authorization","response","res","err","_err$response","status","_err$config","url","config","isAuthEndpoint","includes","removeItem","window","location","reload","Promise","reject","authLogin","email","password","post","authSignup","data","authForgot","authLogout","authMe","get","saveAuth","user","setItem","JSON","stringify","clearAuth","getStoredUser","parse","isAuthenticated","getReports","getReport","id","createReport","updateReport","patch","deleteReport","delete","generateAI","getStats","chatAssistant","messages","system","getPDFUrl","getInlinePDFUrl","getPreviewUrl"],"sources":["D:/New Project/milken_app/frontend/src/services/api.js"],"sourcesContent":["import axios from 'axios';\n\nconst BASE = '/api';\nconst api = axios.create({ baseURL: BASE });\n\n// ── REQUEST: inject token on every call ───────────────────────────────────\napi.interceptors.request.use(cfg => {\n  const token = localStorage.getItem('sfda_token');\n  if (token) cfg.headers.Authorization = `Token ${token}`;\n  return cfg;\n});\n\n// ── RESPONSE: on 401 → wipe stale token and force re-login ───────────────\napi.interceptors.response.use(\n  res => res,\n  err => {\n    if (err.response?.status === 401) {\n      // Only clear if it's NOT an auth endpoint (avoid loop on wrong password)\n      const url = err.config?.url || '';\n      const isAuthEndpoint = url.includes('/auth/login') || url.includes('/auth/signup');\n      if (!isAuthEndpoint) {\n        localStorage.removeItem('sfda_token');\n        localStorage.removeItem('sfda_user');\n        // Reload → App.jsx will detect no token and show login\n        window.location.reload();\n      }\n    }\n    return Promise.reject(err);\n  }\n);\n\n// ── Auth API ──────────────────────────────────────────────────────────────\nexport const authLogin    = (email, password) => api.post('/auth/login/',  { email, password });\nexport const authSignup   = (data)            => api.post('/auth/signup/', data);\nexport const authForgot   = (email)           => api.post('/auth/forgot/', { email });\nexport const authLogout   = ()                => api.post('/auth/logout/');\nexport const authMe       = ()                => api.get('/auth/me/');\n\n// ── Auth helpers (localStorage) ───────────────────────────────────────────\nexport const saveAuth        = (token, user) => { localStorage.setItem('sfda_token', token); localStorage.setItem('sfda_user', JSON.stringify(user)); };\nexport const clearAuth       = ()            => { localStorage.removeItem('sfda_token'); localStorage.removeItem('sfda_user'); };\nexport const getStoredUser   = ()            => { try { return JSON.parse(localStorage.getItem('sfda_user')); } catch { return null; } };\nexport const isAuthenticated = ()            => !!localStorage.getItem('sfda_token');\n\n// ── Reports API ───────────────────────────────────────────────────────────\nexport const getReports      = ()          => api.get('/reports/');\nexport const getReport       = id          => api.get(`/reports/${id}/`);\nexport const createReport    = data        => api.post('/reports/', data);\nexport const updateReport    = (id, data)  => api.patch(`/reports/${id}/`, data);\nexport const deleteReport    = id          => api.delete(`/reports/${id}/`);\nexport const generateAI      = id          => api.post(`/reports/${id}/generate/`);\nexport const getStats        = ()          => api.get('/stats/');\nexport const chatAssistant   = (messages, system) => api.post('/assistant/', { messages, system });\n\n// ── PDF / Preview URLs ────────────────────────────────────────────────────\nexport const getPDFUrl       = id => `${BASE}/reports/${id}/pdf/`;\nexport const getInlinePDFUrl = id => `${BASE}/reports/${id}/pdf/inline/`;\nexport const getPreviewUrl   = id => `${BASE}/reports/${id}/preview/`;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}