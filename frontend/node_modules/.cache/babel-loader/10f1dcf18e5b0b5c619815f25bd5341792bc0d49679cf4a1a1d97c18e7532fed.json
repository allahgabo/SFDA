{"ast":null,"code":"import axios from'axios';const BASE='/api';const api=axios.create({baseURL:BASE});// ── REQUEST: inject token on every call ───────────────────────────────────\napi.interceptors.request.use(cfg=>{const token=localStorage.getItem('sfda_token');if(token)cfg.headers.Authorization=\"Token \".concat(token);return cfg;});// ── RESPONSE: on 401 → wipe stale token and force re-login ───────────────\napi.interceptors.response.use(res=>res,err=>{var _err$response;if(((_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.status)===401){var _err$config;// Only clear if it's NOT an auth endpoint (avoid loop on wrong password)\nconst url=((_err$config=err.config)===null||_err$config===void 0?void 0:_err$config.url)||'';const isAuthEndpoint=url.includes('/auth/login')||url.includes('/auth/signup');if(!isAuthEndpoint){localStorage.removeItem('sfda_token');localStorage.removeItem('sfda_user');// Reload → App.jsx will detect no token and show login\nwindow.location.reload();}}return Promise.reject(err);});// ── Auth API ──────────────────────────────────────────────────────────────\nexport const authLogin=(email,password)=>api.post('/auth/login/',{email,password});export const authSignup=data=>api.post('/auth/signup/',data);export const authForgot=email=>api.post('/auth/forgot/',{email});export const authLogout=()=>api.post('/auth/logout/');export const authMe=()=>api.get('/auth/me/');// ── Auth helpers (localStorage) ───────────────────────────────────────────\nexport const saveAuth=(token,user)=>{localStorage.setItem('sfda_token',token);localStorage.setItem('sfda_user',JSON.stringify(user));};export const clearAuth=()=>{localStorage.removeItem('sfda_token');localStorage.removeItem('sfda_user');};export const getStoredUser=()=>{try{return JSON.parse(localStorage.getItem('sfda_user'));}catch(_unused){return null;}};export const isAuthenticated=()=>!!localStorage.getItem('sfda_token');// ── Reports API ───────────────────────────────────────────────────────────\nexport const getReports=()=>api.get('/reports/');export const getReport=id=>api.get(\"/reports/\".concat(id,\"/\"));export const createReport=data=>api.post('/reports/',data);export const updateReport=(id,data)=>api.patch(\"/reports/\".concat(id,\"/\"),data);export const deleteReport=id=>api.delete(\"/reports/\".concat(id,\"/\"));export const generateAI=id=>api.post(\"/reports/\".concat(id,\"/generate/\"));export const getStats=()=>api.get('/stats/');export const chatAssistant=(messages,system)=>api.post('/assistant/',{messages,system});// ── PDF / Preview URLs ────────────────────────────────────────────────────\nexport const getPDFUrl=id=>\"\".concat(BASE,\"/reports/\").concat(id,\"/pdf/\");export const getInlinePDFUrl=id=>\"\".concat(BASE,\"/reports/\").concat(id,\"/pdf/inline/\");export const getPreviewUrl=id=>\"\".concat(BASE,\"/reports/\").concat(id,\"/preview/\");","map":{"version":3,"names":["axios","BASE","api","create","baseURL","interceptors","request","use","cfg","token","localStorage","getItem","headers","Authorization","concat","response","res","err","_err$response","status","_err$config","url","config","isAuthEndpoint","includes","removeItem","window","location","reload","Promise","reject","authLogin","email","password","post","authSignup","data","authForgot","authLogout","authMe","get","saveAuth","user","setItem","JSON","stringify","clearAuth","getStoredUser","parse","_unused","isAuthenticated","getReports","getReport","id","createReport","updateReport","patch","deleteReport","delete","generateAI","getStats","chatAssistant","messages","system","getPDFUrl","getInlinePDFUrl","getPreviewUrl"],"sources":["D:/New Project/milken_app/frontend/src/services/api.js"],"sourcesContent":["import axios from 'axios';\n\nconst BASE = '/api';\nconst api = axios.create({ baseURL: BASE });\n\n// ── REQUEST: inject token on every call ───────────────────────────────────\napi.interceptors.request.use(cfg => {\n  const token = localStorage.getItem('sfda_token');\n  if (token) cfg.headers.Authorization = `Token ${token}`;\n  return cfg;\n});\n\n// ── RESPONSE: on 401 → wipe stale token and force re-login ───────────────\napi.interceptors.response.use(\n  res => res,\n  err => {\n    if (err.response?.status === 401) {\n      // Only clear if it's NOT an auth endpoint (avoid loop on wrong password)\n      const url = err.config?.url || '';\n      const isAuthEndpoint = url.includes('/auth/login') || url.includes('/auth/signup');\n      if (!isAuthEndpoint) {\n        localStorage.removeItem('sfda_token');\n        localStorage.removeItem('sfda_user');\n        // Reload → App.jsx will detect no token and show login\n        window.location.reload();\n      }\n    }\n    return Promise.reject(err);\n  }\n);\n\n// ── Auth API ──────────────────────────────────────────────────────────────\nexport const authLogin    = (email, password) => api.post('/auth/login/',  { email, password });\nexport const authSignup   = (data)            => api.post('/auth/signup/', data);\nexport const authForgot   = (email)           => api.post('/auth/forgot/', { email });\nexport const authLogout   = ()                => api.post('/auth/logout/');\nexport const authMe       = ()                => api.get('/auth/me/');\n\n// ── Auth helpers (localStorage) ───────────────────────────────────────────\nexport const saveAuth        = (token, user) => { localStorage.setItem('sfda_token', token); localStorage.setItem('sfda_user', JSON.stringify(user)); };\nexport const clearAuth       = ()            => { localStorage.removeItem('sfda_token'); localStorage.removeItem('sfda_user'); };\nexport const getStoredUser   = ()            => { try { return JSON.parse(localStorage.getItem('sfda_user')); } catch { return null; } };\nexport const isAuthenticated = ()            => !!localStorage.getItem('sfda_token');\n\n// ── Reports API ───────────────────────────────────────────────────────────\nexport const getReports      = ()          => api.get('/reports/');\nexport const getReport       = id          => api.get(`/reports/${id}/`);\nexport const createReport    = data        => api.post('/reports/', data);\nexport const updateReport    = (id, data)  => api.patch(`/reports/${id}/`, data);\nexport const deleteReport    = id          => api.delete(`/reports/${id}/`);\nexport const generateAI      = id          => api.post(`/reports/${id}/generate/`);\nexport const getStats        = ()          => api.get('/stats/');\nexport const chatAssistant   = (messages, system) => api.post('/assistant/', { messages, system });\n\n// ── PDF / Preview URLs ────────────────────────────────────────────────────\nexport const getPDFUrl       = id => `${BASE}/reports/${id}/pdf/`;\nexport const getInlinePDFUrl = id => `${BASE}/reports/${id}/pdf/inline/`;\nexport const getPreviewUrl   = id => `${BASE}/reports/${id}/preview/`;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}